# BTD Platform - Jenkins Credentials Template
#
# This file documents the required credentials for Jenkins pipelines
# Store actual credentials in Jenkins Credential Store
#
# Network: 10.27.27.0/23
# Jenkins Server: 10.27.27.251

credentials:
  # GitHub Personal Access Token
  - id: github-pat-btd
    type: string
    description: GitHub Personal Access Token for btd-app repository access
    scope: global
    required_permissions:
      - repo (all)
      - workflow
      - admin:repo_hook
    example: ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

  # Proxmox API Token
  - id: proxmox-api-token
    type: string
    description: Proxmox API token for infrastructure provisioning
    scope: global
    format: "USER@REALM!TOKENID=UUID"
    example: "root@pam!jenkins=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
    api_endpoint: https://10.27.27.192:8006/api2/json
    required_permissions:
      - VM.Allocate
      - VM.Config.Network
      - VM.Config.Disk
      - Datastore.AllocateSpace

  # Ansible SSH Private Key
  - id: ansible-ssh-private-key
    type: ssh_username_with_private_key
    description: SSH private key for Ansible container access
    scope: global
    username: root
    key_location: /var/lib/jenkins/.ssh/ansible_rsa
    passphrase: (if applicable)
    public_key_distribution: Deploy to all LXC containers

  # Consul ACL Token
  - id: consul-acl-token
    type: string
    description: Consul ACL token for Terraform state backend
    scope: global
    consul_address: 10.27.27.27:8500
    required_permissions:
      - key:terraform/* (write)
      - session:* (write)
    example: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx

  # Slack Webhook URL
  - id: slack-webhook-url
    type: string
    description: Slack webhook URL for deployment notifications
    scope: global
    format: https://hooks.slack.com/services/T00000000/B00000000/XXXXXXXXXXXXXXXXXXXX
    channel: "#btd-deployments"
    optional: true

  # Docker Registry Credentials (optional)
  - id: docker-registry-credentials
    type: username_password
    description: Docker registry credentials (if using private registry)
    scope: global
    registry_url: registry.example.com
    optional: true

  # Database Credentials (for migrations)
  - id: btd-database-credentials
    type: username_password
    description: PostgreSQL credentials for database migrations
    scope: global
    host: 10.27.27.30
    port: 5432
    database: btd_platform
    username: btd_admin
    optional: false

  # Redis Credentials
  - id: btd-redis-password
    type: string
    description: Redis password for cache access
    scope: global
    host: 10.27.27.26
    port: 6379
    optional: true

  # MinIO Credentials
  - id: minio-access-credentials
    type: username_password
    description: MinIO access key and secret key
    scope: global
    endpoint: http://10.27.27.28:9000
    username: minio_access_key
    password: minio_secret_key

# Environment Variables (stored in Jenkins)
environment_variables:
  - name: PROXMOX_API_URL
    value: https://10.27.27.192:8006/api2/json
    description: Proxmox API endpoint

  - name: CONSUL_HTTP_ADDR
    value: 10.27.27.27:8500
    description: Consul HTTP address

  - name: TERRAFORM_STATE_BACKEND
    value: consul
    description: Terraform state backend type

  - name: BTD_APP_ROOT
    value: /root/projects/btd-app
    description: BTD application root directory

  - name: ANSIBLE_HOST_KEY_CHECKING
    value: "False"
    description: Disable SSH host key checking for Ansible

# Security Best Practices
security_notes:
  - Never commit credentials to Git repositories
  - Rotate credentials regularly (every 90 days)
  - Use separate credentials for each environment
  - Enable audit logging for credential access
  - Restrict credential scope to specific jobs when possible
  - Use Vault integration for production credentials (recommended)
  - Enable credential masking in Jenkins console output

# Credential Rotation Schedule
rotation_schedule:
  github_pat: Every 90 days
  proxmox_token: Every 180 days
  ansible_ssh_key: Every 365 days
  consul_token: Every 90 days
  database_credentials: Every 60 days (production)

# How to Add Credentials to Jenkins
setup_instructions: |
  1. Log in to Jenkins at http://10.27.27.251:8080
  2. Navigate to: Manage Jenkins > Manage Credentials
  3. Select domain: (global)
  4. Click "Add Credentials"
  5. Fill in the credential details:
     - ID: Use the exact ID from this file
     - Description: Copy from this file
     - Type: Match the type specified above
     - Value: Enter the actual credential value
  6. Click "OK" to save
  7. Verify the credential is listed in the credentials store
  8. Test by running a pipeline that uses the credential

# Verification Commands
verification:
  github_pat: |
    curl -H "Authorization: token YOUR_TOKEN" https://api.github.com/user

  proxmox_token: |
    curl -k -H "Authorization: PVEAPIToken=USER@REALM!TOKENID=UUID" \
      https://10.27.27.192:8006/api2/json/version

  ansible_ssh: |
    ssh -i /var/lib/jenkins/.ssh/ansible_rsa root@10.27.27.100

  consul_token: |
    curl -H "X-Consul-Token: YOUR_TOKEN" \
      http://10.27.27.27:8500/v1/kv/terraform/
